<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsFeed App</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header>

    </header>
    <main>
        <h1>Cactus l'actu qui pique</h1>
        <p>Pour le moment ce site affiche les 20 derniers gros titres pour le territoire français</p>

        <div class="recherche">
            <form action="" method="post">
                <input id="search">
                <button type="button" onclick="myFunction()">Submit</button>
            </form>
        </div>

        <div id="affichage">

        </div>

    </main>
    <footer>

    </footer>
    
    <script>
        
        //La Fonction Commenté affiche les 20 résultat pour la france
        //Stockage de l'adresse de l'API
        const baseUrl= "https://newsapi.org/v2/top-headlines?country=fr&apiKey=67a1e7eeda5e4b8a8498ba7f372c3cfe";

        var baliseForm  = document.querySelector(".recherche");
        var baliseInput = document.querySelector("input[name=search]");
        //Récupération des données
        // const data = fetch(`${baseUrl}`)
        //     .then (function(response)
        //         {
        //         return response.json();
        //         }
        //     )
        //     .then(function(data){

        //         const affichage = document.getElementById("affichage"); 

        //         const articles = data.articles;
        //         console.log(articles)
        //         for(var i = 0; i < articles.length; i++){
                    
        //             const titre = articles[i].title;
        //             const description = articles[i].description;
        //             const url = articles[i].url;
        //             const urlToImage = articles[i].urlToImage;

        //             affichage.innerHTML += 
        //                 `<div>
        //                     <h2>${titre}</h2><img src="${urlToImage}"><p>${description}</p><a href='${url}'>Lire l'article</a>
        //                 </div>`;
        //         }     
        //     });


        //Ici je tente de comparer la saisie avec les résultats disponible pour n'afficher que les résultats pertinents.
        function myFunction() {

            const affichage = document.getElementById("affichage"); 
            const totalResults = data.totalResults;
            const articles = data.articles;
            var x;

            x = document.getElementById("search").value;
            const data = fetch(`${baseUrl}`)
            .then (function(response)
                {
                return response.json();
                }
            )
            .then(function(data){
                for(var i = 0; i < articles.length; i++){

                    const titre = articles[i].title;
                    const description = articles[i].description;

                    if (x == titre || x == description) {
                        const url = articles[i].url;
                        const urlToImage = articles[i].urlToImage;

                        affichage.innerHTML += 
                            `<div>
                                <h2>${titre}</h2><img src="${urlToImage}"><p>${description}</p><a href='${url}'>Lire l'article</a>
                            </div>`;
                    }
                    document.getElementById("affichage").innerHTML = affichage;
                }
            })
        }
    </script>
</body>
</html>